<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>AR MVP — QR → Animación</title>
    <!-- 1) Carga <model-viewer> (Web Component) -->
    <script type="module" src="model-viewer.min.js"></script>
    <style>
      html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
      .wrap { display: grid; place-items: center; height: 100%; background: #0b0f14; color: #dbe0e6; }
      .card { width: min(680px, 92vw); background: #11161d; border: 1px solid #1e2732; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); overflow: hidden; }
      header { padding: 14px 18px; border-bottom: 1px solid #1e2732; display: flex; align-items: center; gap: 8px; }
      header h1 { font-size: 16px; margin: 0; font-weight: 600; }
      .hint { opacity: .8; font-size: 12px; }
      .row { display: grid; grid-template-columns: 1fr; }
      model-viewer { width: 100%; height: 66vh; min-height: 440px; background: radial-gradient(1200px 500px at 50% 100%, #1a2430 0%, #0b0f14 60%); }
      footer { display: grid; gap: 8px; padding: 14px 18px; border-top: 1px solid #1e2732; }
      .btns { display: flex; gap: 10px; flex-wrap: wrap; }
      button, a.btn { appearance: none; border: 1px solid #223041; background: #17202b; color: #e7edf5; padding: 10px 14px; border-radius: 999px; font-size: 14px; text-decoration: none; cursor: pointer; }
      button:hover, a.btn:hover { filter: brightness(1.1); }
      .note { font-size: 12px; opacity: .75; }
      .ok { color: #7fffb1; }
    </style>
  </head>
  <body>
    <div class="wrap">
      <div class="card">
        <header>
          <h1>AR PRUEBA— QR → Animación</h1>
          <span class="hint">Escanéame desde un QR o abre este link directo</span>
        </header>

        <!-- 2) El visor. Cambia src/usdz a tu propio modelo -->
        <!-- Astronauta GLB tiene animación "Idle"; Scene Viewer/Quick Look abren AR nativo -->
        <div class="row">
          <model-viewer id="viewer"
            src="Loreto2.glb"
            ios-src="Loreto2.usdz"
            ar
            ar-modes="scene-viewer quick-look webxr"
            camera-controls
            autoplay
            animation-name="Idle"
            exposure="1"
            shadow-intensity="1"
            environment-image="neutral"
            poster="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1600' height='900'/%3E"
            alt="Fuerte de Loreto animado en AR" >
          </model-viewer>
        </div>

        <footer>
          <div class="btns">
            <button id="btnAR">Abrir en AR</button>
            <button id="btnRotate">Toggle rotación</button>
            <a class="btn" href="#" id="btnShare">Compartir enlace</a>
          </div>
          <p class="note">Android abre <span class="ok">Scene Viewer</span>, iOS usa <span class="ok">Quick Look</span>. En desktop verás el modelo 3D con controles.</p>
        </footer>
      </div>
    </div>

    <script>
      const mv = document.getElementById('viewer');
      const btnAR = document.getElementById('btnAR');
      const btnRotate = document.getElementById('btnRotate');
      const btnShare = document.getElementById('btnShare');

      // Forzar apertura de AR (igual que tocar el botón nativo del componente)
      btnAR.addEventListener('click', () => mv.activateAR());

      // Rotación sencilla por JS si el modelo no trae animación
      let spinning = false, raf;
      function spin() {
        if (!spinning) return; 
        mv.cameraOrbit = `${(Date.now()/80)%360}deg 65deg 2.2m`;
        raf = requestAnimationFrame(spin);
      }
      btnRotate.addEventListener('click', () => {
        spinning = !spinning;
        if (spinning) spin(); else cancelAnimationFrame(raf);
      });

      // Compartir/crear URL listo para QR
      btnShare.addEventListener('click', async (e) => {
        e.preventDefault();
        const url = location.href;
        try {
          await navigator.clipboard.writeText(url);
          btnShare.textContent = 'Enlace copiado ✅';
        } catch {
          location.assign(url);
        }
      });

      // Si llegas con ?model=... en la URL, cargar ese modelo al vuelo
      const params = new URLSearchParams(location.search);
      const model = params.get('model');
      const usdz = params.get('usdz');
      if (model) mv.src = model;
      if (usdz) mv.setAttribute('ios-src', usdz);
    </script>
  </body>

</html>
